import{R as B,r as o,j as e,u as S,i as x,a as C}from"./index-Bccf4OWe.js";import{B as v}from"./backbutton-CJhFJDbj.js";const _=({comments:l,onCommentSubmit:u})=>{const[n,r]=B.useState(""),[d,a]=o.useState(!1);o.useEffect(()=>{(async()=>{if(!d)return;const f=localStorage.getItem("access_token");a(!!f)})()},[d]);const j=()=>{n.trim()&&(u(n),r(""))};return e.jsxs("div",{className:"blog-comment-container",children:[e.jsxs("h3",{children:["Comments (",l.length,")"]}),e.jsx("ul",{className:"comment-list",children:l.map(c=>e.jsxs("li",{className:"comment-item",children:[e.jsxs("div",{className:"comment-meta",children:[e.jsx("strong",{children:c.author_username})," ·"," ",new Date(c.created_at).toLocaleDateString()]}),e.jsx("div",{className:"comment-text",children:c.content})]},c.id))}),e.jsx("textarea",{className:"comment-input",value:n,onChange:c=>r(c.target.value),placeholder:"Add a comment...",rows:4}),e.jsx("button",{className:"comment-submit",onClick:j,disabled:!n.trim(),children:d?"Submit":"comment"})]})},$=[{type:"like",emoji:"👍"},{type:"dislike",emoji:"👎"},{type:"love",emoji:"❤️"},{type:"funny",emoji:"😂"},{type:"sad",emoji:"😢"},{type:"angry",emoji:"😠"}],w=({blogId:l})=>{const[u,n]=o.useState([]),[r,d]=o.useState(null),[a,j]=o.useState(!1),{id:c}=S(),f=async()=>{try{const s=localStorage.getItem("access_token"),m=(await x.get(`/blog/detail/${c}/`,{headers:s?{Authorization:`Bearer ${s}`}:{}})).data;n(m.reaction_summary||[])}catch(s){console.error("Failed to fetch reactions:",s)}};o.useEffect(()=>{f()},[l]);const p=async s=>{const i=localStorage.getItem("access_token");if(!i)return alert("Login to react.");j(!0);try{r===s?(await x.delete(`/blog/reaction/delete/${l}/`,{headers:{Authorization:`Bearer ${i}`}}),d(null)):(await x.post(`/blog/reaction/create/${l}/`,{reaction:s},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}}),d(s)),f()}catch(m){console.error("Failed to react:",m)}finally{j(!1)}};return e.jsxs("div",{className:"reaction-buttons",children:[e.jsx("h5",{children:"Reactions"}),e.jsx("div",{className:"reaction-list",children:$.map(({type:s,emoji:i})=>{var b;const m=((b=u.find(y=>y.reaction===s))==null?void 0:b.count)||0,N=r===s;return e.jsxs("button",{onClick:()=>p(s),disabled:a,className:`reaction-btn ${N?"active":""}`,children:[i," ",e.jsx("small",{children:m>0?`${m}`:"0"})]},s)})})]})},R=void 0,A=()=>{const[l,u]=o.useState([]),{id:n}=S(),[r,d]=o.useState(!1),[a,j]=o.useState(null),[c,f]=o.useState([]),[p,s]=o.useState(!0),[i,m]=o.useState(""),N=C();o.useEffect(()=>{n&&(async()=>{try{const h=(await x.get(`/blog/detail/${n}/`)).data;j(h.blog),u(h.comments||[])}catch(g){console.error("Failed to fetch blog detail:",g),m("Failed to load the blog post. Please try again.")}finally{s(!1)}})()},[n]),o.useEffect(()=>{const t=localStorage.getItem("access_token");(async()=>{try{const h=await x.get("/blog/list/",{headers:t?{Authorization:`Bearer ${t}`}:{},withCredentials:!0});f(h.data)}catch(h){console.error("Failed to fetch blog data:",h)}finally{s(!1)}})()},[]);const b=async t=>{if(t.trim())try{const g=localStorage.getItem("access_token"),h=await x.post(`/blog/comment/create/${n}/`,{content:t},{headers:g?{Authorization:`Bearer ${g}`}:{}});u(k=>[...k,h.data])}catch(g){console.error("Failed to submit comment:",g)}};if(p)return e.jsx("p",{className:"blog-loading",children:"Loading post..."});if(i)return e.jsx("p",{className:"blog-error",children:i});if(!a)return e.jsx("p",{className:"blog-empty",children:"No blog post found."});const y=a.image.startsWith("http")?a.image:`${R}${a.image}`;return e.jsxs("article",{className:"blog-detail",children:[e.jsx(v,{}),e.jsxs("section",{className:"blog-detail-body",children:[e.jsx("header",{className:"blog-detail-header",children:e.jsx("h1",{className:"blog-detail-title",children:a.title})}),e.jsx("img",{src:y,alt:a.title,className:"blog-detail-image"}),e.jsxs("div",{className:"blog-detail-content",children:[e.jsxs("p",{className:"blog-detail-meta",children:["By ",e.jsx("strong",{children:a.author_username})," ·"," ",new Date(a.created_at).toLocaleDateString()]}),e.jsxs("p",{className:"blog-detail-dicription",children:[r?a.content.slice(0,1e3):a.content.slice(0,360),e.jsx("span",{onClick:()=>d(!r),children:r?" Less":" ...More"})]}),e.jsx(w,{blogId:n})]}),e.jsx(_,{comments:l.map(t=>({...t,created_at:typeof t.created_at=="string"?Date.parse(t.created_at):t.created_at})),onCommentSubmit:b}),e.jsxs("div",{className:"related-blogs",children:[e.jsx("h4",{children:"Related Blogs"}),c.length===0?e.jsx("p",{children:"No blogs found!"}):e.jsx(e.Fragment,{children:c.map(t=>e.jsxs("div",{className:"related-blog-card",onClick:()=>N(`blog/detail/${t.id}`),children:[e.jsx("img",{src:t.image,alt:""}),e.jsxs("div",{className:"related-blog-info",children:[e.jsx("p",{className:"related-blog-author",children:t.author_username}),e.jsx("p",{className:"related-blog-title",children:t.title}),e.jsxs("span",{children:["comments ",l.length]})]})]},t.id))})]})]})]})};export{A as default};
