import{r as t,a as j,j as e,L as f,i as N,l as b,N as k,m as S,n as F,o as P,p as w,q as C,s as y,t as v,v as L,w as I,O as U}from"./index-wSDtZMXp.js";import{a as _,b as A,c as E,d as D}from"./index-DfAQnLW4.js";const $=()=>{const[a,m]=t.useState(null),[h,l]=t.useState(null),[c,d]=t.useState(!0),[s,i]=t.useState(null),u=j();t.useEffect(()=>{(async()=>{var p;const o=localStorage.getItem("access_token");if(!o){i("You must be logged in to view your profile."),d(!1);return}try{const r=await N.get("/users/me/",{headers:{Authorization:`Bearer ${o}`}});m(r.data)}catch(r){typeof r=="object"&&r!==null&&"response"in r&&((p=r.response)==null?void 0:p.status)===401?(i("Session expired. Please log in again."),localStorage.removeItem("access_token"),u("/login")):i("Failed to load profile.")}finally{d(!1)}})()},[u]);const x=n=>{l(o=>o===n?null:n)};if(c)return e.jsx("div",{className:"topnav-loading",children:"Loading..."});if(s)return e.jsx("div",{className:"topnav-error",children:s});const g=[{name:"",image:e.jsx("div",{className:"topnav-profile-image",children:e.jsx("img",{src:`http://127.0.0.1:8000/${a==null?void 0:a.profile_image}`,alt:`${a==null?void 0:a.first_name} ${a==null?void 0:a.last_name}`})}),path:"#",sublinks:[{name:"Profile",path:"/admin/profile"},{name:"Logout",path:"/logout"},{name:"Help",path:"/admin/help"}]}];return e.jsxs("nav",{className:"topnav",children:[e.jsx("div",{className:"topnav-left",children:e.jsx("h2",{children:a==null?void 0:a.username})}),e.jsx("div",{className:"topnav-right",children:e.jsx("ul",{className:"topnav-links",children:g.map((n,o)=>e.jsxs("li",{className:"topnav-item",children:[e.jsxs("div",{role:"button",className:"topnav-link",onClick:()=>n.sublinks&&x(o),children:[n.name," ",n.image]}),n.sublinks&&h===o&&e.jsx("ul",{className:"topnav-sublinks",children:n.sublinks.map((p,r)=>e.jsx("li",{className:"topnav-sublink-item",children:e.jsx(f,{to:p.path,className:"topnav-sublink-link",onClick:()=>l(null),children:p.name})},r))})]},o))})})]})},R=()=>{const[a,m]=t.useState(!1),h=j(),l=()=>{localStorage.removeItem("access_token"),h("/login")},c=()=>{m(!a)},d=[{name:"Dashboard",path:"/adminPage/overview",icon:e.jsx(F,{})},{name:"Users",path:"/adminPage/users",icon:e.jsx(P,{})},{name:"Products",path:"/adminPage/products",icon:e.jsx(w,{})},{name:"Orders",path:"/adminPage/orders",icon:e.jsx(C,{})},{name:"Invoices",path:"/adminPage/invoices",icon:e.jsx(y,{})},{name:"Blog",path:"/adminPage/blog",icon:e.jsx(E,{})},{name:"Subscriptions",path:"/adminPage/subscriptions",icon:e.jsx(v,{})},{name:"Report",path:"/adminPage/report",icon:e.jsx(v,{})},{name:"Help",path:"/adminPage/help",icon:e.jsx(D,{})}];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sidebar-toggle",onClick:()=>c(),children:a?e.jsx(_,{}):e.jsx(A,{})}),e.jsxs("aside",{className:a?"sidebar shrink":"sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsx(f,{to:"/",children:e.jsx("img",{src:b,alt:""})})}),e.jsx("nav",{children:e.jsxs("ul",{className:"sidebar-links",children:[d.map(s=>e.jsx("li",{children:e.jsxs(k,{to:s.path,className:({isActive:i})=>`sidebar-link ${i?"active":""}`,children:[e.jsx("span",{className:"sidebar-icon",children:s.icon}),e.jsx("span",{className:a?"name":"",children:s.name})]})},s.name)),e.jsx("li",{children:e.jsxs("button",{className:a?"sidebar-link logout-button":"",onClick:l,children:[e.jsx(S,{}),e.jsx("span",{className:a?"name":"",children:"Logout"})]})})]})})]})]})},H=()=>{const[a,m]=t.useState(null),[h,l]=t.useState(!0),[c,d]=t.useState(null),{setShowNav:s,setShowFooter:i}=L(),u=j();return t.useEffect(()=>(s(!1),i(!1),()=>{s(!0),i(!0)}),[s,i]),t.useEffect(()=>{(async()=>{const g=localStorage.getItem("access_token");if(!g){d("You must be logged in."),l(!1);return}try{const n=await N.get("/users/me/",{headers:{Authorization:`Bearer ${g}`}});m(n.data)}catch{localStorage.removeItem("access_token"),u("/login")}finally{l(!1)}})()},[u]),h?e.jsx("div",{className:"main",children:"Verifying admin access..."}):!a||a.role!=="admin"?e.jsx(I,{to:"/",replace:!0}):e.jsxs("div",{className:"admin-page",children:[e.jsx(R,{}),c&&e.jsx("div",{className:"alert alert-danger w-100 text-center",children:c}),e.jsxs("div",{className:"admin-content",children:[e.jsx($,{}),e.jsx(U,{})]})]})};export{H as default};
