import{r as i,a as C,j as e,i as p,y as v,k as D,X as P,Y as $,I as F}from"./index-DrOKnMkI.js";import O from"./adminPage-CrsqvMsw.js";import{C as z}from"./confirmDelete-BRdewAfo.js";import"./index-C_26DXfd.js";const A=()=>{const[s,o]=i.useState(null),[c,n]=i.useState(null),t=C();return i.useEffect(()=>{(async()=>{const l=localStorage.getItem("access_token");if(!l){n("You must be logged in to view your profile.");return}try{const j=await p.get("/users/me/",{headers:{Authorization:`Bearer ${l}`}});o(j.data)}catch{n("Failed to load profile.")}})()},[t]),c?e.jsx("div",{className:"error-message",children:c}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"heading",children:e.jsx("h1",{children:"Profile"})}),e.jsxs("div",{className:"profile-detail",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Username:"})," ",s==null?void 0:s.username]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s==null?void 0:s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Date Joined:"})," ",s==null?void 0:s.date_joined]}),e.jsx("button",{className:"change-password",onClick:()=>t("/change-password"),children:"Change Password"})]})]})},R=()=>{const[s,o]=i.useState(null);return i.useEffect(()=>{(async()=>{const n=localStorage.getItem("access_token");if(n)try{const t=await p.get("/orders/shipping/user/",{headers:{Authorization:`Bearer ${n}`}});console.log("Shipping Response:",t.data),Array.isArray(t.data)&&t.data.length>0?o(t.data[0]):o(null)}catch{v.error("Shipping fetch failed:")}})()},[]),e.jsx("div",{children:e.jsxs("div",{className:"profile-shipping-container",children:[e.jsx("h2",{children:"Shipping Address"}),s?e.jsxs("div",{className:"shipping-details",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.full_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 1:"})," ",s.address1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address 2:"})," ",s.address2]}),e.jsxs("p",{children:[e.jsx("strong",{children:"City:"})," ",s.city]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",s.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Zipcode:"})," ",s.zipcode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Country:"})," ",s.country]})]}):e.jsx("p",{className:"no-address",children:"No shipping address found."})]})})},U=()=>{const[s,o]=i.useState([]),c=async()=>{const n=localStorage.getItem("access_token"),t=await p.get("/orders/invoices/user/",{headers:n?{Authorization:`Bearer ${n}`}:{}});o(t.data)};return i.useEffect(()=>{c()},[]),e.jsxs("div",{className:"invoices-container",children:[e.jsx("h1",{children:"All Invoices"}),e.jsxs("table",{className:"invoices-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(n=>e.jsxs("tr",{children:[e.jsx("td",{children:n.id}),e.jsx("td",{children:new Date(n.created_at).toLocaleDateString()}),e.jsx("td",{children:n.status}),e.jsxs("td",{className:"action-buttons",children:[e.jsx("button",{onClick:()=>alert(`Viewing ${n.id}`),children:"View"}),e.jsx("button",{onClick:()=>alert(`Editing ${n.id}`),children:"Edit"}),e.jsx("button",{onClick:()=>alert(`Deleting ${n.id}`),children:"Delete"}),n.pdf_file&&e.jsx("a",{href:n.pdf_file,target:"_blank",rel:"noopener noreferrer",download:!0,className:"download-link",children:e.jsx("button",{children:"Download"})})]})]},n.id))})]}),s.length===0&&e.jsx("p",{children:"No invoices found."})]})},B=()=>{const[s,o]=i.useState([]),[c,n]=i.useState(1),t=C(),x=5;i.useEffect(()=>{(async()=>{const m=localStorage.getItem("access_token"),a=await p.get("/orders/list/",{headers:{Authorization:`Bearer ${m}`}});o(a.data),console.log(a.data)})()},[]);const l=s,j=c*x,g=j-x,f=l.slice(g,j),k=Math.ceil(l.length/x),S=async r=>{try{const m=localStorage.getItem("access_token");await p.post(`/orders/${r}/cancel/`,{},{headers:{Authorization:`Bearer ${m}`}}),v.success("Order cancelled and stock restored."),o(a=>a.filter(d=>d.id!==r))}catch{v.error("Failed to cancel order.")}},b=async r=>{try{const m=localStorage.getItem("access_token");await p.post(`/orders/request-refund/${r}/`,{},{headers:{Authorization:`Bearer ${m}`}}),v.success("Refund request sent!"),o(a=>a.map(d=>d.id===r?{...d,refundRequested:!0}:d))}catch{v.error("Failed to request refund.")}};return e.jsxs("div",{className:"order-list",children:[e.jsx("h1",{children:"All Orders"}),e.jsx("div",{className:"order-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total price"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:f.length>0?f.map((r,m)=>e.jsxs("tr",{children:[e.jsx("td",{children:m+1+(c-1)*x}),e.jsx("td",{children:r.status}),e.jsx("td",{children:r.total_price}),e.jsxs("td",{children:[r.status==="pending"?e.jsxs("div",{className:"pending-order-actions",children:[e.jsx("button",{onClick:()=>t("/shop/checkout/payment",{state:{orderId:r.id}}),className:"btn-primary",children:"💳 Resume Payment"}),e.jsx("button",{onClick:()=>S(r.id),className:"btn-secondary",children:"❌ Cancel Order"})]}):e.jsx("button",{className:"btn-edit",title:"View Order",onClick:()=>alert(`View details for order ${r.id}`),children:"✏️ Info"}),r.status==="delivered"&&!r.refundRequested&&e.jsx("button",{onClick:()=>b(r.id),children:"Request Refund"})]})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center",children:"No Orders found."})})})]})}),e.jsx("div",{className:"pagination",children:[...Array(k).keys()].map(r=>e.jsx("button",{onClick:()=>n(r+1),className:c===r+1?"active":"",children:r+1},r+1))})]})},y=5,M=()=>{const[s,o]=i.useState([]),[c,n]=i.useState(!1),[t,x]=i.useState(null),[l,j]=i.useState(1),g=C(),{addItem:f}=D();i.useEffect(()=>{(async()=>{const d=localStorage.getItem("access_token");try{const N=await p.get("/wishlist/list/",{headers:{Authorization:`Bearer ${d}`}});o(N.data),console.log(N.data)}catch{console.error("❌ Failed to load wishlist.")}})()},[]);const k=a=>{x(a),n(!0)},S=async()=>{if(!t)return;n(!1);const a=localStorage.getItem("access_token");try{await p.delete(`/wishlist/delete/${t}/`,{headers:{Authorization:`Bearer ${a}`}}),o(d=>d.filter(N=>N.id!==t)),v.success("✅ Item removed from wishlist!")}catch{v.error("❌ Failed to delete item.")}},b=Math.ceil(s.length/y),r=(l-1)*y,m=s.slice(r,r+y);return e.jsx("div",{className:"wishlist",children:e.jsxs("div",{className:"wishlist-container",children:[e.jsx("h2",{className:"wishlist-header",children:"Your Wishlist"}),s.length===0?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Your Wishlist is empty."}),e.jsx("button",{className:"button-shop",onClick:()=>g("/shop"),children:"Go to Shop"})]}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"wish-items-list",children:m.map(a=>e.jsxs("li",{className:"wish-item",children:[e.jsx("img",{src:a.product.image,alt:a.product.name,onError:d=>d.currentTarget.src="/images/placeholder.jpg",className:"cart-item-image"}),e.jsxs("div",{className:"wish-item-info",children:[e.jsxs("span",{className:"cart-item-name",children:[a.product.name," - $",a.product.price]}),e.jsxs("div",{className:"cart-item-controls",children:[e.jsx("button",{onClick:()=>f({...a.product,stock:1,quantity:1}),children:"Add to Cart"}),e.jsx("button",{onClick:()=>g(`/product/${a.product.id}`),children:"View"}),e.jsx("button",{onClick:()=>k(a.id),children:"🗑️"})]})]})]},a.id))}),e.jsxs("div",{className:"pagination",children:[e.jsx("button",{onClick:()=>j(a=>Math.max(a-1,1)),disabled:l===1,children:"Previous"}),[...Array(b)].map((a,d)=>e.jsx("button",{className:l===d+1?"active":"",onClick:()=>j(d+1),children:d+1},d+1)),e.jsx("button",{onClick:()=>j(a=>Math.min(a+1,b)),disabled:l===b,children:"Next"})]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{onClick:()=>g("/shop"),children:"Continue Shopping"}),e.jsx("button",{onClick:()=>g("/cart"),children:"View Cart"})]})]}),e.jsx(z,{isOpen:c,title:"Remove from Wishlist",message:"Are you sure you want to remove this item?",onConfirm:S,onCancel:()=>n(!1)})]})})},q=()=>{const[s,o]=i.useState([]),c=async()=>{const t=await p.get("/my-subscriptions/");o(t.data)},n=async t=>{await p.post(`/subscriptions/${t}/cancel/`),o(x=>x.map(l=>l.id===t?{...l,active:!1}:l))};return i.useEffect(()=>{c()},[]),e.jsxs("div",{className:"subscription-dashboard",children:[e.jsx("h2",{children:"My Subscriptions"}),s.length===0?e.jsx("p",{children:"No subscriptions found."}):e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Provider"}),e.jsx("th",{children:"Subscription ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Started At"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.provider}),e.jsx("td",{children:t.external_id}),e.jsx("td",{children:e.jsx("span",{className:t.active?"badge active":"badge inactive",children:t.active?"Active":"Cancelled"})}),e.jsx("td",{children:new Date(t.created_at).toLocaleDateString()}),e.jsx("td",{children:t.active&&e.jsx("button",{onClick:()=>n(t.id),className:"cancel-btn",children:"Cancel"})})]},t.id))})]})]})},L=()=>{const[s,o]=i.useState("profile"),[c,n]=i.useState(null),[t,x]=i.useState(null),[l,j]=i.useState(!1),g=C(),[f,k]=i.useState(null),[S,b]=i.useState(""),[r,m]=i.useState(null),a=()=>{j(!l)};i.useEffect(()=>{(async()=>{const u=localStorage.getItem("access_token");if(!u){x("You must be logged in to view your profile."),g("/login");return}try{const w=await p.get("/users/me/",{headers:{Authorization:`Bearer ${u}`}});n(w.data)}catch{x("Failed to load profile."),g("/login")}})()},[g]),i.useEffect(()=>{(async()=>{const u=localStorage.getItem("access_token");try{await p.get("/users/me/",{headers:{Authorization:`Bearer ${u}`}})}catch{localStorage.removeItem("access_token"),v.error("Failed to load profile.")}})()},[]);const d=()=>{const h=[{name:"profile"},{name:"shipping address"},{name:"orders"},{name:"wishlist"},{name:"invoices"},{name:"subscriptions"}].filter(u=>u.name);return e.jsx("div",{className:l?"profile-tab-container small":"profile-tab-container",children:h.map((u,w)=>e.jsx("button",{onClick:()=>{o(u.name)},className:s===u.name?"active":"",children:u.name},w))})},N=()=>{switch(s){case"Profile":return e.jsx(A,{});case"shipping address":return e.jsx(R,{});case"dashboard":return e.jsx(O,{});case"invoices":return e.jsx(U,{});case"wishlist":return e.jsx(M,{});case"orders":return e.jsx(B,{});case"subscriptions":return e.jsx(q,{});default:return e.jsx(A,{})}};if(t)return e.jsx("div",{className:"error-message",children:t});const I=h=>{c&&(k(h),b(String(c[h])))},_=()=>{k(null),b(""),m(null)},E=async()=>{if(!(!c||!f))try{const h=localStorage.getItem("access_token"),u=new FormData;f==="profile_image"&&r?u.append("profile_image",r):u.append(f,S);const w=await p.patch(`/users/update/${c.id}/`,u,{headers:{Authorization:`Bearer ${h}`,"Content-Type":"multipart/form-data"}});n(w.data),k(null),m(null),b("")}catch(h){h instanceof Error?alert("Update failed: "+h.message):alert("Update failed: An unknown error occurred")}};return e.jsx("div",{className:"profile-management",children:e.jsxs("div",{className:"container",children:[e.jsx("div",{className:l?"tabs show":"tabs",children:d()}),e.jsx("div",{className:"bars",onClick:a,children:l?e.jsx(P,{}):e.jsx($,{})}),e.jsx("div",{className:"profile",children:e.jsx("div",{className:"profile-container",children:f==="profile_image"?e.jsxs(e.Fragment,{children:[e.jsx("input",{title:"image",type:"file",accept:"image/*",className:"image-edit",onChange:h=>{h.target.files&&h.target.files.length>0&&m(h.target.files[0])}}),e.jsx("button",{className:"pro-pic-edit",onClick:E,children:"Save"}),e.jsx("button",{className:"pro-pic-edit",onClick:_,children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:c!=null&&c.profile_image?c.profile_image:F,alt:"Profile",className:"proImage",loading:"lazy"}),e.jsx("button",{className:"pro-pic-edit",onClick:()=>I("profile_image"),children:"Edit"})]})})}),e.jsx("div",{className:"contents",children:N()})]})})};export{L as default};
