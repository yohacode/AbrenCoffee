import{r as o,a as y,j as e,i as f,y as v,k as C,L as N,U as g,V as k,W as w,z as S}from"./index-DrOKnMkI.js";import{h as F}from"./index-C_26DXfd.js";const q=({selectedProducts:s})=>{const[i,n]=o.useState("stripe"),[u,h]=o.useState(!1),l=y(),m=async()=>{if(s.length===0){alert("No subscription products selected.");return}h(!0);try{const a=localStorage.getItem("access_token"),c=await f.post("/subscription/to/",{provider:i,price:s[0].price,frequency:s[0].frequency,product_id:s[0].id},{headers:{Authorization:`Bearer ${a}`}});c.data.checkout_url?window.location.href=c.data.checkout_url:alert("No checkout URL returned.")}catch{v.error("Failed to subscribe. Login First!"),l("/login")}finally{h(!1)}};return e.jsxs("div",{className:"subscription-checkout",children:[e.jsx("h2",{className:"checkout-title",children:"Ready to Subscribe?"}),e.jsx("label",{htmlFor:"provider-select",className:"provider-label",children:"Payment Provider"}),e.jsxs("select",{id:"provider-select",className:"provider-select",value:i,onChange:a=>n(a.target.value),children:[e.jsx("option",{value:"stripe",children:"Stripe"}),e.jsx("option",{value:"paypal",children:"PayPal"})]}),e.jsx("button",{className:"subscribe-button",onClick:m,disabled:u,children:u?"Redirecting...":`Subscribe with ${i}`})]})},P=[{number:1,title:"Choose Your Favorite Coffee"},{number:2,title:"Determine order interval"},{number:3,title:"Add to cart and All done"}],A=[{title:"Weekly Plan",description:"Fresh coffee delivered every week.",price:"$15/week"},{title:"Monthly Plan",description:"A curated selection of beans monthly.",price:"$45/month"},{title:"Office Plan",description:"Bulk deliveries for your workspace.",price:"Custom Quote"}],_=[{href:"https://www.facebook.com/abrenCoffee",icon:e.jsx(g,{})},{href:"https://www.instagram.com/abrenCoffee",icon:e.jsx(F,{})},{href:"https://www.tiktok.com/@abrenCoffee",icon:e.jsx(k,{})},{href:"https://www.twitch.tv/abrenCoffee",icon:e.jsx(w,{})},{href:"https://x.com/abrenCoffee",icon:e.jsx(S,{})}],I=()=>e.jsx("div",{className:"subscripton-payment",children:_.map(({href:s,icon:i},n)=>e.jsx(N,{to:s,className:"social",target:"_blank",rel:"noopener noreferrer",children:i},n))}),L=({title:s,description:i,price:n})=>e.jsxs("div",{className:"plan-card",children:[e.jsx("h2",{children:s}),e.jsx("p",{children:i}),e.jsx("span",{className:"price",children:n})]}),E=({number:s,title:i})=>e.jsxs("div",{className:"guid-card",children:[e.jsx("span",{children:s}),e.jsx("p",{children:i})]}),O=({product:s,frequency:i,onFrequencyChange:n,onAddToCart:u,onRemove:h,onUpdateQuantity:l,isLoading:m})=>{const a=s.stock===0,c=s.quantity??1;return e.jsxs("article",{className:"item-card",children:[e.jsx("img",{src:s.image,alt:s.name,className:"product-image"}),e.jsx("h3",{children:s.name}),e.jsxs("p",{className:"price",children:["$",s.price.toFixed(2)]}),e.jsxs("div",{className:"cart-item-controls",children:[e.jsx("button",{onClick:()=>l(s.id,c-1),disabled:c<=1,children:"➖"}),e.jsx("button",{onClick:()=>l(s.id,c+1),children:"➕"}),e.jsx("button",{onClick:()=>h(s.id),children:"🗑️"})]}),e.jsxs("select",{value:i,onChange:p=>n(s.id,p.target.value),className:"frequency-select","aria-label":"Delivery frequency",children:[e.jsx("option",{value:"none",children:"One-time"}),e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"monthly",children:"Monthly"})]}),e.jsx("button",{className:"addCart",onClick:()=>u({...s,delivery_frequency:i}),disabled:m||a,children:m?"Adding...":a?"Out of Stock":"Add to Cart"})]},s.id)},M=()=>{const[s,i]=o.useState({}),[n,u]=o.useState([]),[h,l]=o.useState(new Set),{removeItem:m,updateItemQuantity:a,cartItemCount:c,addItem:p}=C();o.useEffect(()=>{f.get("/products/list/").then(t=>{const d=t.data.filter(r=>r.is_subscription).map(r=>({...r,price:Number(r.price),quantity:Number(r.quantity),delivery_frequency:"none"}));u(d)}).catch(()=>console.error("Failed to load subscription products."))},[]);const x=o.useCallback((t,d)=>{i(r=>({...r,[t]:d}))},[]),j=o.useCallback(t=>{l(d=>new Set(d).add(t.id)),p(t),setTimeout(()=>{l(d=>{const r=new Set(d);return r.delete(t.id),r})},500)},[p]),b=n.filter(t=>s[t.id]&&s[t.id]!=="none");return e.jsx("div",{className:"subscription",children:e.jsxs("div",{className:"subscription-container",children:[e.jsxs("section",{className:"subscription-hero",children:[e.jsx("h1",{className:"subscription-title",children:"Subscribe to Fresh Coffee"}),e.jsx("p",{className:"subscription-intro",children:"Enjoy premium coffee weekly or monthly."}),e.jsx("p",{children:"Enjoy 10% off for subscribers!"}),e.jsx(I,{})]}),e.jsx("section",{className:"subscription-plans",children:A.map(t=>e.jsx(L,{...t},t.title))}),e.jsx("section",{className:"subscription-guide",children:P.map(t=>e.jsx(E,{...t},t.number))}),e.jsx("section",{className:"subscription-items",children:n.map(t=>e.jsx(O,{product:t,frequency:s[t.id]||"none",onFrequencyChange:x,onAddToCart:j,onRemove:m,onUpdateQuantity:a,isLoading:h.has(t.id),cartItemCount:c},t.id))}),b.length>0&&e.jsx(q,{selectedProducts:b.map(t=>({...t,price:t.price.toString(),frequency:s[t.id],is_subscription:!0}))})]})})};export{M as default};
