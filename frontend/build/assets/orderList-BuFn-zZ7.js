import{r as n,a as P,j as e,F as A,i as u,y as c}from"./index-DrOKnMkI.js";import{C as R}from"./confirmDelete-BRdewAfo.js";const T=()=>{const[y,l]=n.useState([]),[x,g]=n.useState(""),[d,C]=n.useState(1),[O,i]=n.useState(!1),[o,f]=n.useState(null),a=5,S=P();n.useEffect(()=>{(async()=>{const t=localStorage.getItem("access_token"),r=await u.get("/adminPanel/orders/",{headers:{Authorization:`Bearer ${t}`}});l(r.data)})()},[]);const k=s=>{f(s),i(!0)},b=async()=>{if(o===null)return;i(!1);const s=localStorage.getItem("access_token");try{await u.delete(`/orders/delete/${o}/`,{headers:{Authorization:`Bearer ${s}`}}),c.success("✅ Invoice deleted successfully!"),l(t=>t.filter(r=>r.id!==o))}catch{c.error("❌ Failed to delete order.")}finally{f(null)}},v=async s=>{try{const t=localStorage.getItem("access_token");await u.post(`/orders/${s}/process-refund/`,{},{headers:{Authorization:`Bearer ${t}`}}),c.success("✅ Refund processed successfully!"),l(r=>r.map(h=>h.id===s?{...h,refund_status:"processed",status:"refunded"}:h))}catch{c.error("❌ Failed to process refund.")}},j=y.filter(s=>s.status.toLowerCase().includes(x.toLowerCase())),m=d*a,w=m-a,p=j.slice(w,m),N=Math.ceil(j.length/a);return e.jsxs("div",{className:"order-list",children:[e.jsx("h2",{children:"All Orders"}),e.jsx("input",{type:"text",placeholder:"Search by status...",value:x,onChange:s=>g(s.target.value),style:{marginBottom:"1rem",padding:"5px",width:"200px"}}),e.jsx("div",{className:"order-table",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Id"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Session key"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Total price"}),e.jsx("th",{children:"Refund Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.length>0?p.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1+(d-1)*a}),e.jsx("td",{children:s.id}),e.jsx("td",{children:s.user}),e.jsx("td",{children:s.session_key}),e.jsx("td",{children:s.status}),e.jsx("td",{children:s.total_price}),e.jsx("td",{children:s.refundRequested?e.jsx("span",{children:s.refund_status==="processed"?"Processed":"Requested"}):"—"}),e.jsxs("td",{children:[e.jsx("button",{title:"View",className:"btn-edit",onClick:()=>S(`/adminPage/orders/detail/${s.id}`),children:e.jsx(A,{})}),e.jsx("button",{title:"Delete",className:"btn-delete",onClick:()=>k(s.id),children:"🗑️"}),s.refundRequested&&s.refund_status==="requested"&&e.jsx("button",{className:"btn-refund",onClick:()=>v(s.id),children:"Process Refund"})]})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center",children:"No Orders found."})})})]})}),e.jsx("div",{className:"pagination",children:[...Array(N).keys()].map(s=>e.jsx("button",{onClick:()=>C(s+1),className:d===s+1?"active":"",children:s+1},s+1))}),e.jsx(R,{isOpen:O,title:"Delete Invoice",message:"Are you sure you want to delete this invoice? Only Pending orders can be deleted. This action cannot be undone.",onConfirm:b,onCancel:()=>i(!1)})]})};export{T as default};
