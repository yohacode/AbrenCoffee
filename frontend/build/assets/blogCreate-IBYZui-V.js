import{r as n,j as e,i as k,y,b as _}from"./index-DrOKnMkI.js";import{S as B}from"./react-select.esm-WdFkTFAn.js";const I=({onClose:d,isOpen:h})=>{const[j,C]=n.useState(!1),p=n.useRef(null),[f,r]=n.useState({name:""}),t=o=>{const{name:g,type:i,value:b,checked:v,files:m}=o.target;i==="file"&&(m!=null&&m[0])?r(u=>({...u,image:m[0]})):r(i==="checkbox"?u=>({...u,[g]:v}):u=>({...u,[g]:b}))},l=async o=>{o.preventDefault(),C(!0);const g=localStorage.getItem("access_token"),i=new FormData;i.append("name",f.name);try{await k.post("/blog/category/create/",i,{headers:{Authorization:`Bearer ${g}`,"Content-Type":"multipart/form-data"}}),y.success("✅ Blog Category created successfully!"),r({name:""}),p.current&&(p.current.value="")}catch(b){y.error("❌ Failed to create blog category. Please try again."),console.error(b)}finally{C(!1)}};return h?e.jsx(e.Fragment,{children:e.jsx("div",{className:`category-create ${h?"open":""}`,children:e.jsxs("form",{onSubmit:l,className:"category-form",children:[e.jsx("button",{className:"close-btn",onClick:d,children:"×"}),e.jsx("h2",{children:"Create Blog Category"}),e.jsx("div",{className:"form-group",children:e.jsx("input",{type:"text",name:"name",placeholder:"name",value:f.name,onChange:t,className:"form-input",required:!0})}),e.jsx("button",{type:"submit",disabled:j,className:"category-form-button",children:j?"Submitting...":"Create Blog Category"})]})})}):null},L=()=>{const[d,h]=n.useState(!1),[j,C]=n.useState([]),[p,f]=n.useState(!1),r=n.useRef(null),[t,l]=n.useState({title:"",image:"",content:"",category:1,is_published:!1});n.useEffect(()=>{(async()=>{try{const c=localStorage.getItem("access_token"),a=await k.get("/blog/category/",{headers:{Authorization:`Bearer ${c}`}});C(a.data)}catch{y.error("❌ Failed to load categories")}})()},[]);const o=s=>{const{name:c,type:a,value:S,checked:F,files:N}=s.target;a==="file"&&(N!=null&&N[0])?l(x=>({...x,image:N[0]})):l(a==="checkbox"?x=>({...x,[c]:F}):x=>({...x,[c]:S}))},g=s=>{l(c=>({...c,categories:s.map(a=>Number(a.value))}))},i=async s=>{s.preventDefault(),f(!0);const c=localStorage.getItem("access_token"),a=new FormData;a.append("title",t.title),a.append("content",t.content),a.append("is_published",String(t.is_published)),a.append("category",String(t.category)),t.image instanceof File&&a.append("image",t.image);try{await k.post("/blog/create/",a,{headers:{Authorization:`Bearer ${c}`,"Content-Type":"multipart/form-data"}}),y.success("✅ Blog created successfully!"),l({title:"",image:"",content:"",category:1,is_published:!1}),r.current&&(r.current.value="")}catch(S){y.error("❌ Failed to create blog. Please try again."),console.error(S)}finally{f(!1)}},b=()=>{h(!d)},v=()=>{h(!d)},m=s=>{s.target instanceof HTMLDivElement&&s.target.classList.contains("category-create")&&v()};n.useEffect(()=>(document.addEventListener("click",m),()=>{document.removeEventListener("click",m)}),[]);const u=()=>e.jsx("div",{className:"category-create",children:e.jsx(I,{isOpen:d,onClose:v})});return e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:i,className:"blog-form",children:[e.jsx("h2",{children:"Create New Blog"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",name:"title",placeholder:"title",value:t.title,onChange:o,className:"form-input",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Content"}),e.jsx("input",{type:"textArea",name:"content",placeholder:"content",className:"form-input",value:t.content,onChange:o})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image"}),e.jsx("input",{title:"file",type:"file",name:"image",ref:r,onChange:o,accept:"image/*",className:"form-input",required:!0}),t.image instanceof File&&e.jsx("img",{src:URL.createObjectURL(t.image),alt:"Preview",className:"form-preview"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:["Categories ",e.jsxs("button",{onClick:()=>b(),children:[e.jsx(_,{})," Add"]})]}),e.jsx(B,{isMulti:!0,placeholder:"Select categories",onChange:g,options:j.map(s=>({value:s.id,label:s.name}))})]}),e.jsxs("div",{className:"form-checkbox",children:[e.jsx("input",{type:"checkbox",name:"is_published",placeholder:"is_published",checked:t.is_published,onChange:o}),e.jsx("label",{htmlFor:"is_published",children:"Publish Immediately"})]}),e.jsx("button",{type:"submit",disabled:p,className:"form-button",children:p?"Submitting...":"Create Blog"})]}),d?e.jsx("div",{className:"category-create",children:u()}):e.jsx(e.Fragment,{})]})};export{L as default};
