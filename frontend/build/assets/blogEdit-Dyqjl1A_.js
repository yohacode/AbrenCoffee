import{u as $,a as E,r,j as e,i,y as l}from"./index-DrOKnMkI.js";import{S as P}from"./react-select.esm-WdFkTFAn.js";const _="https://abrencoffeeproduction.onrender.com",A=()=>{const{id:c}=$(),d=E(),[v,S]=r.useState(!0),[C,B]=r.useState([]),[N,k]=r.useState(null),[u,g]=r.useState(""),[p,h]=r.useState(""),[n,m]=r.useState(null),[b,w]=r.useState(null),[f,x]=r.useState(null),[j,y]=r.useState(!1);r.useEffect(()=>{(async()=>{try{const o=localStorage.getItem("access_token"),s=(await i.get(`/blog/detail/${c}/`,{headers:{Authorization:`Bearer ${o}`}})).data.blog;k(s),g(s.title),h(s.content),m(s.category?{id:s.category.id,name:s.category.name}:null),y(s.is_published),x(s.image.startsWith("http")?s.image:`${_}${s.image}`)}catch{l.error("❌ Failed to load blog data.")}finally{S(!1)}})()},[c]),r.useEffect(()=>{(async()=>{try{const o=localStorage.getItem("access_token"),a=await i.get("/blog/category/",{headers:{Authorization:`Bearer ${o}`}});B(a.data)}catch{l.error("❌ Failed to load categories.")}})()},[]);const I=t=>{t&&m({id:t.value,name:t.label})},U=async t=>{t.preventDefault();try{if(!n)return l.error("Please select a category.");const o=localStorage.getItem("access_token"),a=new FormData;a.append("title",u),a.append("content",p),a.append("category",n.id.toString()),a.append("is_published",j?"true":"false"),b&&a.append("image",b);const s=await i.put(`/blog/update/${c}/`,a,{headers:{Authorization:`Bearer ${o}`}});l.success("✅ Blog updated successfully!"),console.log("Update response:",s.data),d(-2)}catch(o){console.error(o),l.error("❌ Failed to update blog.")}};return v?e.jsx("div",{className:"center-text",children:"Loading blog info..."}):N?e.jsxs("div",{className:"update-container",children:[e.jsx("h2",{className:"update-title",children:"Update Blog"}),e.jsxs("form",{onSubmit:U,className:"update-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{value:u,onChange:t=>g(t.target.value),required:!0,placeholder:"Enter blog title"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Content"}),e.jsx("textarea",{value:p,onChange:t=>h(t.target.value),required:!0,placeholder:"Enter blog content"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Image"}),f&&e.jsx("img",{src:f,alt:"Preview",style:{width:"120px",marginBottom:"8px",borderRadius:"6px"}}),e.jsx("input",{title:"Upload an image",accept:"image/*",type:"file",onChange:t=>{var a;const o=(a=t.target.files)==null?void 0:a[0];o&&(w(o),x(URL.createObjectURL(o)))}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsx(P,{placeholder:"Select category",options:C.map(t=>({value:t.id,label:t.name})),onChange:I,value:n?{value:n.id,label:n.name}:null})]}),e.jsxs("div",{className:"form-checkbox",children:[e.jsx("input",{placeholder:"publish",type:"checkbox",checked:j,onChange:t=>y(t.target.checked)}),e.jsx("label",{children:"Publish"})]}),e.jsxs("div",{className:"button-group",children:[e.jsx("button",{type:"button",onClick:()=>d(-1),className:"back-button",children:"← Back"}),e.jsx("button",{type:"submit",className:"submit-button",children:"Update Blog"})]})]})]}):e.jsx("div",{className:"center-text error",children:"Blog not found"})};export{A as default};
